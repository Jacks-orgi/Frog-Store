DROP TABLE IF EXISTS sessions;
DROP TABLE IF EXISTS related_products;
DROP TABLE IF EXISTS user_card_info;
DROP TABLE IF EXISTS cart;
DROP TABLE IF EXISTS order_items;
DROP TABLE IF EXISTS order_details;
DROP TABLE IF EXISTS user_address_info;
DROP TABLE IF EXISTS users;
DROP TABLE IF EXISTS products;

CREATE TABLE products (
  id INT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(100) NOT NULL,
  price DECIMAL(10, 2) NOT NULL,
  status ENUM('In Stock', 'Sold Out') DEFAULT 'In Stock',
  category ENUM('plushies', 'stress-helpers') DEFAULT 'plushies',
  image_url TEXT,
  description VARCHAR(255) NOT NULL
);

CREATE TABLE users (
  id INT PRIMARY KEY AUTO_INCREMENT,
  firstname VARCHAR(50) NOT NULL,
  lastname VARCHAR(50) NOT NULL,
  username VARCHAR(50) NOT NULL UNIQUE,
  email VARCHAR(50) NOT NULL UNIQUE,
  phone VARCHAR(20),
  password VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE user_address_info (
  id INT PRIMARY KEY AUTO_INCREMENT,
  user_id INT NOT NULL,
  address_line1 VARCHAR(255) NOT NULL,
  address_line2 VARCHAR(255),
  city VARCHAR(100) NOT NULL,
  state VARCHAR(100) NOT NULL,
  postcode VARCHAR(20) NOT NULL,
  country VARCHAR(100) NOT NULL,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE order_details (
  id INT PRIMARY KEY AUTO_INCREMENT,
  user_id INT NOT NULL,
  address_id INT,
  total DECIMAL(10, 2) NOT NULL,
  status ENUM('Created', 'Pending Payment', 'In shipping', 'Cancelled', 'Completed') DEFAULT 'Created',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (address_id) REFERENCES user_address_info(id) ON DELETE SET NULL
);

CREATE TABLE order_items (
  order_id INT NOT NULL,
  product_id INT NOT NULL,
  quantity INT NOT NULL DEFAULT 1,
  PRIMARY KEY (order_id, product_id),
  FOREIGN KEY (order_id) REFERENCES order_details(id) ON DELETE CASCADE,
  FOREIGN KEY (product_id) REFERENCES products(id)
);

CREATE TABLE cart (
  user_id INT NOT NULL,
  product_id INT NOT NULL,
  quantity INT NOT NULL,
  PRIMARY KEY (user_id, product_id),
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (product_id) REFERENCES products(id)
);

CREATE TABLE user_card_info (
  user_id INT NOT NULL PRIMARY KEY,
  card_number BIGINT NOT NULL,
  expiration DATE NOT NULL,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE related_products (
  product_id INT NOT NULL,
  related_product_id INT NOT NULL,
  PRIMARY KEY (product_id, related_product_id),
  FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
  FOREIGN KEY (related_product_id) REFERENCES products(id) ON DELETE CASCADE
);

CREATE TABLE sessions (
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  token VARCHAR(64) NOT NULL UNIQUE,
  expires_at DATETIME NOT NULL,
  FOREIGN KEY (user_id) REFERENCES users(id)
);

-- USERS
INSERT INTO users (firstname, lastname, username, email, phone, password) VALUES
('Admin', 'Admin', 'Admin', 'admin@admin.com', '07123456789', '$2y$10$oBqElM2Cjn6f9wV6CXSRieJabhY1L17NKex6czDMU37T5fgPcUhYm'),
('Bob', 'Johnson', 'bobbyJ', 'bob@example.com', '07123456789', '$2y$10$oBqElM2Cjn6f9wV6CXSRieJabhY1L17NKex6czDMU37T5fgPcUhYm');

-- USER ADDRESSES
INSERT INTO user_address_info (user_id, address_line1, address_line2, city, state, postcode, country) VALUES
(1, '123 Admin Street', '', 'Adminville', 'Adminstate', 'ADM123', 'Adminland'),
(2, '456 Bob Avenue', '', 'Bobtown', 'Bobstate', 'BOB456', 'Bobland');

-- USER CARD INFO
INSERT INTO user_card_info (user_id, card_number, expiration) VALUES
(1, 4111111111111111, '2026-12-31'),
(2, 5500000000000004, '2025-08-15');

-- PRODUCTS
INSERT INTO products (name, price, status, category, image_url, description) VALUES
('Wireless Mouse', 25.99, 'In Stock', 'stress-helpers', 'https://2-12.co.uk/~ddar/FrogStore/assets/frog.jpg', 'A great product for everyday use.'),
('Bluetooth Headset', 49.99, 'Sold Out', 'stress-helpers', 'https://2-12.co.uk/~ddar/FrogStore/assets/frog.jpg', 'A great product for everyday use.'),
('Water Bottle', 12.50, 'In Stock', 'plushies', 'https://2-12.co.uk/~ddar/FrogStore/assets/frog.jpg', 'A great product for everyday use.'),
('Hoodie', 34.00, 'In Stock', 'stress-helpers', 'https://2-12.co.uk/~ddar/FrogStore/assets/frog.jpg', 'A great product for everyday use.'),
('Laptop Stand', 29.99, 'Sold Out', 'stress-helpers', 'https://2-12.co.uk/~ddar/FrogStore/assets/frog.jpg', 'A great product for everyday use.'),
('LED Desk Lamp', 19.99, 'In Stock', 'plushies','https://2-12.co.uk/~ddar/FrogStore/assets/frog.jpg', 'A great product for everyday use.'),
('Running Shoes', 59.99, 'In Stock', 'plushies', 'https://2-12.co.uk/~ddar/FrogStore/assets/frog.jpg', 'A great product for everyday use.');

-- RELATED PRODUCTS
INSERT INTO related_products (product_id, related_product_id) VALUES
(1, 2), 
(1, 5), 
(1, 3),
(2, 1),
(2, 6),
(3, 4),
(4, 3), 
(4, 7),
(5, 1),
(6, 2),
(7, 4),
(3, 1),
(5, 6),
(6, 7),
(7, 2),
(2, 7);

-- CART
INSERT INTO cart (user_id, product_id, quantity) VALUES
(1, 1, 5),
(1, 2, 1),
(1, 3, 3),
(2, 1, 4);

-- ORDER DETAILS
INSERT INTO order_details (user_id, address_id, total, status) VALUES
(1, 1, 63.48, 'Completed'),
(2, 2, 49.99, 'Pending Payment');

-- ORDER ITEMS
INSERT INTO order_items (order_id, product_id, quantity) VALUES
(1, 1, 2),
(1, 3, 1),
(2, 2, 1);
